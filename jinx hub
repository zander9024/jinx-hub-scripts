local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local playerGui = player:WaitForChild("PlayerGui")

-- GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "DivineFarmMenu"
screenGui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 350, 0, 150)
frame.Position = UDim2.new(0.5, -175, 0.5, -75)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.BorderSizePixel = 0
frame.Parent = screenGui
frame.Active = true
frame.Draggable = true

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,0,0,30)
title.Position = UDim2.new(0,0,0,0)
title.Text = "Divine Farm"
title.TextScaled = true
title.BackgroundColor3 = Color3.fromRGB(50,50,50)
title.TextColor3 = Color3.new(1,1,1)
title.Parent = frame

-- Toggle
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0,300,0,50)
toggleButton.Position = UDim2.new(0.5,-150,0.5,-25)
toggleButton.Text = "Divine Farm: OFF"
toggleButton.TextScaled = true
toggleButton.BackgroundColor3 = Color3.fromRGB(0,170,255)
toggleButton.TextColor3 = Color3.new(1,1,1)
toggleButton.Parent = frame

-- Close
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0,30,0,30)
closeButton.Position = UDim2.new(1,-35,0,5)
closeButton.Text = "X"
closeButton.TextScaled = true
closeButton.BackgroundColor3 = Color3.fromRGB(170,0,0)
closeButton.TextColor3 = Color3.new(1,1,1)
closeButton.Parent = frame

-- Variables
local farmRunning = false
local validTiers = {
    Common=true, Uncommon=true, Rare=true, Epic=true, Legendary=true,
    Mythical=true, Cosmic=true, Secret=true, Celestial=true, Divine=true
}

-- Get current tier
local function getCurrentTier()
    local HUD = game.StarterPlayer:FindFirstChild("TowerTrialHUD")
    if not HUD then return nil end
    local TrialBar = HUD:FindFirstChild("TrialBar")
    if not TrialBar then return nil end
    local Requirement = TrialBar:FindFirstChild("Requirement")
    if not Requirement then return nil end

    local text = Requirement.Text or ""
    local cleanText = text:gsub("<.->",""):gsub("^%s+",""):gsub("%s+$","")
    for tier,_ in pairs(validTiers) do
        if cleanText:find(tier) then
            return tier
        end
    end
    return nil
end

-- Teleport to random brainrot of tier
local function teleportToTier(tier)
    local activeFolder = workspace:FindFirstChild("ActiveBrainrots")
    if not activeFolder then return end
    local tierFolder = activeFolder:FindFirstChild(tier)
    if not tierFolder then return end
    local models = tierFolder:GetChildren()
    if #models == 0 then return end

    local randomModel = models[math.random(1,#models)]
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if hrp then
        local targetCFrame
        if randomModel.PrimaryPart then
            targetCFrame = randomModel.PrimaryPart.CFrame
        else
            for _,child in pairs(randomModel:GetDescendants()) do
                if child:IsA("BasePart") then
                    targetCFrame = child.CFrame
                    break
                end
            end
        end
        if targetCFrame then
            hrp.CFrame = targetCFrame + Vector3.new(0,3,0)
        end
    end
end

-- Toggle logic
toggleButton.MouseButton1Click:Connect(function()
    farmRunning = not farmRunning
    toggleButton.Text = "Divine Farm: "..(farmRunning and "ON" or "OFF")

    if farmRunning then
        spawn(function()
            while farmRunning do
                local tier = getCurrentTier()
                if tier then
                    print("Detected Tier:", tier)
                    teleportToTier(tier)
                end
                wait(2)
            end
        end)
    end
end)

-- Close
closeButton.MouseButton1Click:Connect(function()
    screenGui.Enabled = false
end)
